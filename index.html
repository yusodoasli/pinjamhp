<!DOCTYPE html>
<html>
<head>
Â  Â  <title>Log & Status HP Sekolah (Mobile Final)</title>
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">Â 
Â  Â  <style>
Â  Â  Â  Â  /* Pengaturan Dasar dan Font */
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;Â 
Â  Â  Â  Â  Â  Â  margin: 0;Â 
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  background-color: #f4f4f9;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Container Utama */
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Judul */
Â  Â  Â  Â  h2, h3 {Â 
Â  Â  Â  Â  Â  Â  color: #333;Â 
Â  Â  Â  Â  Â  Â  margin-top: 15px;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Input, Select, Button (Ukuran Mobile) */
Â  Â  Â  Â  input[type="text"], input[type="number"], select, button {Â 
Â  Â  Â  Â  Â  Â  padding: 12px; /* Lebih besar */
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  Â  Â  border-radius: 8px; /* Lebih halus */
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  button {
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s;
Â  Â  Â  Â  Â  Â  color: white; /* Warna teks putih untuk semua tombol */
Â  Â  Â  Â  }
Â  Â  Â  Â  button:active {
Â  Â  Â  Â  Â  Â  opacity: 0.8;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Warna Tombol */
Â  Â  Â  Â  .btn-pagi { background-color: #f44336; border: none; }Â 
Â  Â  Â  Â  .btn-pinjam { background-color: #4CAF50; border: none; }
Â  Â  Â  Â  .btn-kembali { background-color: #008CBA; border: none; }
Â  Â  Â  Â  .btn-export { background-color: #ff9800; border: none; }
Â  Â  Â  Â  .btn-reset { background-color: #d32f2f; border: none; }

Â  Â  Â  Â  /* Form Section */
Â  Â  Â  Â  .form-section {Â 
Â  Â  Â  Â  Â  Â  background-color: white;Â 
Â  Â  Â  Â  Â  Â  padding: 15px;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 12px;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .form-section h3 {
Â  Â  Â  Â  Â  Â  Â border-bottom: 2px solid #eee;Â 
Â  Â  Â  Â  Â  Â  Â padding-bottom: 8px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Tabs Mobile View --- */
Â  Â  Â  Â  .tab-buttons {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  position: sticky;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #ddd;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button {
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  padding: 15px 10px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  background-color: #eee;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  font-size: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button.active {
Â  Â  Â  Â  Â  Â  background-color: #008CBA;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-content {
Â  Â  Â  Â  Â  Â  padding: 15px 0;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-content.active {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Tabel Status dan Log (Scrollable) --- */
Â  Â  Â  Â  .table-wrapper {
Â  Â  Â  Â  Â  Â  overflow-x: auto; /* Memungkinkan scroll horizontal pada tabel */
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  table {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  min-width: 600px; /* Minimal lebar tabel agar tidak terlalu sempit */
Â  Â  Â  Â  Â  Â  border-collapse: collapse;Â 
Â  Â  Â  Â  Â  Â  margin-top: 5px;Â 
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  }
Â  Â  Â  Â  th, td {Â 
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;Â 
Â  Â  Â  Â  Â  Â  padding: 10px;Â 
Â  Â  Â  Â  Â  Â  text-align: left;Â 
Â  Â  Â  Â  Â  Â  font-size: 12px; /* Ukuran font lebih kecil agar kolom muat */
Â  Â  Â  Â  }
Â  Â  Â  Â  th {Â 
Â  Â  Â  Â  Â  Â  background-color: #333;Â 
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  position: sticky;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #status_inventaris th { background-color: #555; }
Â  Â  Â  Â  #status_body td:nth-child(3) { font-weight: bold; } /* HP Keluar */
Â  Â  </style>
</head>
<body>

Â  Â  <div class="container">
Â  Â  Â  Â  <h2>ğŸ“ Log HP Sekolah</h2>
Â  Â  </div>

Â  Â  <div class="tab-buttons">
Â  Â  Â  Â  <button class="tab-button active" onclick="showTab('input', this)">Input Data</button>
Â  Â  Â  Â  <button class="tab-button" onclick="showTab('status', this)">Status Inventaris</button>
Â  Â  Â  Â  <button class="tab-button" onclick="showTab('log', this)">Riwayat Log</button>
Â  Â  </div>

Â  Â  <div class="container">
Â  Â  Â  Â  <div id="input" class="tab-content active">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="form-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>1. PENGUMPULAN PAGI (HP Awal)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size: 14px; margin-top: -10px; color: #777;">Mencatat HP Awal hari untuk kelas.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="pagi_kelas" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Pilih Kelas...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X FAR">X FAR</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 1">X KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 2">X KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 3">X KP 3</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI FAR 1">XI FAR 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI FAR 2">XI FAR 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 1">XI KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 2">XI KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 3">XI KP 3</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII FAR 1">XII FAR 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII FAR 2">XII FAR 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII KP 1">XII KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII KP 2">XII KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="pagi_jumlah" placeholder="Jumlah HP Dikumpulkan" required>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-pagi" onclick="catatPengumpulanPagi()">Catat Pengumpulan Sekarang</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="form-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>2. PINJAM (HP KELUAR)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="pinjam_pj" placeholder="Nama PJ/Peminjam" required>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="pinjam_kelas" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Pilih Kelas...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X FAR">X FAR</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 1">X KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 2">X KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 3">X KP 3</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI FAR 1">XI FAR 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI FAR 2">XI FAR 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 1">XI KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 2">XI KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 3">XI KP 3</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII FAR 1">XII FAR 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII FAR 2">XII FAR 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII KP 1">XII KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII KP 2">XII KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="pinjam_jumlah" placeholder="Jumlah HP Dipinjam" required>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="pinjam_guru" placeholder="Guru Mata Pelajaran" required>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-pinjam" onclick="catatPeminjaman()">Catat Peminjaman Sekarang</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>3. KEMBALI (HP MASUK)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="kembali_pj" placeholder="Nama PJ/Pengembali" required>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="kembali_kelas" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Pilih Kelas...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X FAR">X FAR</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 1">X KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 2">X KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="X KP 3">X KP 3</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI FAR 1">XI FAR 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI FAR 2">XI FAR 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 1">XI KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 2">XI KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XI KP 3">XI KP 3</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII FAR 1">XII FAR 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII FAR 2">XII FAR 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII KP 1">XII KP 1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="XII KP 2">XII KP 2</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="kembali_jumlah" placeholder="Jumlah HP Dikembalikan" required>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-kembali" onclick="catatPengembalian()">Catat Pengembalian Sekarang</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-section" style="background-color: #fff8e1;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>âš™ï¸ PENGATURAN & CADANGAN DATA</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-export" onclick="exportLogToCSV()">EXPORT RIWAYAT LOG (.csv) - CADANGAN</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-reset" onclick="hapusSemuaData()">HAPUS SEMUA RIWAYAT LOG & STATUS (RESET TOTAL)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size: 0.8em; color: #757575; text-align: center;">âš ï¸ **Peringatan:** Wajib Cadangkan Data sebelum Reset Total!</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="status" class="tab-content">
Â  Â  Â  Â  Â  Â  <h3>ğŸ“Š Status HP Terkini</h3>
Â  Â  Â  Â  Â  Â  <div class="table-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <table id="status_inventaris">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Kelas</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>HP Awal</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>HP Keluar</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>HP Sisa</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Keterangan</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="status_body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="log" class="tab-content">
Â  Â  Â  Â  Â  Â  <h3>Riwayat Log (Aksi)</h3>
Â  Â  Â  Â  Â  Â  <div class="table-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <table id="log_table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Aksi</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Waktu</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>PJ/Peminjam</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Kelas</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Jml HP</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Guru Mapel</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="log_body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div> <script>
Â  Â  Â  Â  const LOG_KEY = 'hp_log_data';
Â  Â  Â  Â  const DAFTAR_KELAS = [
Â  Â  Â  Â  Â  Â  "X FAR", "X KP 1", "X KP 2", "X KP 3",
Â  Â  Â  Â  Â  Â  "XI FAR 1", "XI FAR 2", "XI KP 1", "XI KP 2", "XI KP 3",
Â  Â  Â  Â  Â  Â  "XII FAR 1", "XII FAR 2", "XII KP 1", "XII KP 2"
Â  Â  Â  Â  ];

Â  Â  Â  Â  // --- FUNGSI TABS ---
Â  Â  Â  Â  function showTab(tabId, element) {
Â  Â  Â  Â  Â  Â  const contents = document.querySelectorAll('.tab-content');
Â  Â  Â  Â  Â  Â  contents.forEach(content => content.classList.remove('active'));

Â  Â  Â  Â  Â  Â  const buttons = document.querySelectorAll('.tab-button');
Â  Â  Â  Â  Â  Â  buttons.forEach(button => button.classList.remove('active'));

Â  Â  Â  Â  Â  Â  document.getElementById(tabId).classList.add('active');
Â  Â  Â  Â  Â  Â  element.classList.add('active');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Pastikan data diperbarui saat berpindah ke tab Status/Log
Â  Â  Â  Â  Â  Â  if (tabId === 'status') {
Â  Â  Â  Â  Â  Â  Â  Â  perbaruiStatusInventaris();
Â  Â  Â  Â  Â  Â  } else if (tabId === 'log') {
Â  Â  Â  Â  Â  Â  Â  Â  tampilkanLog();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- FUNGSI DASAR (SAMA SEPERTI SEBELUMNYA) ---
Â  Â  Â  Â  function muatLog() {
Â  Â  Â  Â  Â  Â  const data = localStorage.getItem(LOG_KEY);
Â  Â  Â  Â  Â  Â  return data ? JSON.parse(data) : [];
Â  Â  Â  Â  }

Â  Â  Â  Â  function simpanLog(logData) {
Â  Â  Â  Â  Â  Â  localStorage.setItem(LOG_KEY, JSON.stringify(logData));
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- FUNGSI EKSPOR DATA KE CSV ---
Â  Â  Â  Â  function exportLogToCSV() {
Â  Â  Â  Â  Â  Â  const logData = muatLog();
Â  Â  Â  Â  Â  Â  if (logData.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Tidak ada data log untuk diekspor.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const headers = ["Aksi", "Waktu", "Tanggal", "PJ_Peminjam", "Kelas", "Jumlah_HP", "Guru_Mapel"];

Â  Â  Â  Â  Â  Â  const rows = logData.map(item => [
Â  Â  Â  Â  Â  Â  Â  Â  item.aksi,
Â  Â  Â  Â  Â  Â  Â  Â  new Date(item.waktu).toLocaleTimeString('id-ID'),
Â  Â  Â  Â  Â  Â  Â  Â  new Date(item.waktu).toLocaleDateString('id-ID'),
Â  Â  Â  Â  Â  Â  Â  Â  item.pj || '',Â 
Â  Â  Â  Â  Â  Â  Â  Â  item.kelas,
Â  Â  Â  Â  Â  Â  Â  Â  item.jumlah,
Â  Â  Â  Â  Â  Â  Â  Â  item.guru || '-'
Â  Â  Â  Â  Â  Â  ]);

Â  Â  Â  Â  Â  Â  let csvContent = headers.join(";") + "\n" + rows.map(e => e.join(";")).join("\n");

Â  Â  Â  Â  Â  Â  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
Â  Â  Â  Â  Â  Â  const link = document.createElement("a");
Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);

Â  Â  Â  Â  Â  Â  link.setAttribute("href", url);
Â  Â  Â  Â  Â  Â  link.setAttribute("download", `log_hp_${new Date().toLocaleDateString('id-ID').replace(/\//g, '-')}.csv`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.body.appendChild(link);
Â  Â  Â  Â  Â  Â  link.click();
Â  Â  Â  Â  Â  Â  document.body.removeChild(link);
Â  Â  Â  Â  Â  Â  alert("Data log berhasil diekspor ke file CSV!");
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNGSI HAPUS SEMUA DATA (RESET TOTAL) ---
Â  Â  Â  Â  function hapusSemuaData() {
Â  Â  Â  Â  Â  Â  if (confirm("ANDA YAKIN INGIN MENGHAPUS SEMUA RIWAYAT LOG DAN STATUS INVENTARIS? Pastikan Anda sudah mencadangkan data!")) {
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem(LOG_KEY);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Semua data log berhasil dihapus. Halaman akan dimuat ulang untuk memulai sesi baru.");
Â  Â  Â  Â  Â  Â  Â  Â  location.reload();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNGSI STATUS INVENTARIS ---
Â  Â  Â  Â  function perbaruiStatusInventaris() {
Â  Â  Â  Â  Â  Â  const logData = muatLog();
Â  Â  Â  Â  Â  Â  const statusBody = document.getElementById('status_body');
Â  Â  Â  Â  Â  Â  statusBody.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const statusKelas = {};Â 

Â  Â  Â  Â  Â  Â  logData.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const kelas = item.kelas;
Â  Â  Â  Â  Â  Â  Â  Â  if (!statusKelas[kelas]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusKelas[kelas] = { awal: 0, keluar: 0, sisa: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const jumlah = parseInt(item.jumlah);

Â  Â  Â  Â  Â  Â  Â  Â  if (item.aksi === 'PENGUMPULAN PAGI') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusKelas[kelas].awal = jumlah;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (item.aksi === 'PINJAM (KELUAR)') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusKelas[kelas].keluar += jumlah;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (item.aksi === 'KEMBALI (MASUK)') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusKelas[kelas].keluar -= jumlah;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  DAFTAR_KELAS.forEach(kelas => {
Â  Â  Â  Â  Â  Â  Â  Â  const status = statusKelas[kelas] || { awal: 0, keluar: 0, sisa: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  status.sisa = status.awal - status.keluar;

Â  Â  Â  Â  Â  Â  Â  Â  const row = statusBody.insertRow();
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = kelas;
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = status.awal;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const cellKeluar = row.insertCell();
Â  Â  Â  Â  Â  Â  Â  Â  cellKeluar.textContent = status.keluar < 0 ? 'Error!' : status.keluar;
Â  Â  Â  Â  Â  Â  Â  Â  cellKeluar.style.backgroundColor = status.keluar > 0 ? '#ffdddd' : '#ddffdd';Â 

Â  Â  Â  Â  Â  Â  Â  Â  const cellSisa = row.insertCell();
Â  Â  Â  Â  Â  Â  Â  Â  cellSisa.textContent = status.sisa;
Â  Â  Â  Â  Â  Â  Â  Â  cellSisa.style.fontWeight = 'bold';
Â  Â  Â  Â  Â  Â  Â  Â  cellSisa.style.color = status.sisa < 0 ? 'red' : 'green';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let keterangan = '';
Â  Â  Â  Â  Â  Â  Â  Â  if (status.awal === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keterangan = 'Belum ada pengumpulan.';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (status.sisa < 0 || status.keluar < 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keterangan = 'ERROR!';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.style.backgroundColor = '#ffcdd2';Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else if (status.keluar > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keterangan = 'Sedang Dipinjam.';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keterangan = 'HP Lengkap.';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = keterangan;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNGSI UTAMA (tampilkanLog) ---
Â  Â  Â  Â  function tampilkanLog() {
Â  Â  Â  Â  Â  Â  const logData = muatLog();
Â  Â  Â  Â  Â  Â  const logBody = document.getElementById('log_body');
Â  Â  Â  Â  Â  Â  logBody.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  logData.sort((a, b) => new Date(b.waktu) - new Date(a.waktu));

Â  Â  Â  Â  Â  Â  logData.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const row = logBody.insertRow();
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = item.aksi.replace('(KELUAR)', 'K').replace('(MASUK)', 'M').replace('PENGUMPULAN PAGI', 'PAGI'); // Singkat untuk mobile
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = new Date(item.waktu).toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = item.pj || '-';
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = item.kelas;
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = item.jumlah;
Â  Â  Â  Â  Â  Â  Â  Â  row.insertCell().textContent = item.guru || '-';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNGSI PENGUMPULAN PAGI ---
Â  Â  Â  Â  function catatPengumpulanPagi() {
Â  Â  Â  Â  Â  Â  const kelas = document.getElementById('pagi_kelas').value;Â 
Â  Â  Â  Â  Â  Â  const pj = '-'; // PJ Dihapus dari input, ditetapkan default
Â  Â  Â  Â  Â  Â  const jumlah = document.getElementById('pagi_jumlah').value;

Â  Â  Â  Â  Â  Â  if (!kelas || !jumlah) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Pilih Kelas dan isi Jumlah HP pada Pengumpulan Pagi!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const logData = muatLog();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Filter logData untuk MENGHAPUS HANYA log 'PENGUMPULAN PAGI' yang lama untuk kelas ini.
Â  Â  Â  Â  Â  Â  let newLogData = logData.filter(item => !(item.aksi === 'PENGUMPULAN PAGI' && item.kelas === kelas));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Tambahkan log Pengumpulan Pagi yang baru (menimpa yang lama)
Â  Â  Â  Â  Â  Â  newLogData.unshift({
Â  Â  Â  Â  Â  Â  Â  Â  aksi: 'PENGUMPULAN PAGI',
Â  Â  Â  Â  Â  Â  Â  Â  waktu: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  pj: pj,Â 
Â  Â  Â  Â  Â  Â  Â  Â  kelas: kelas,
Â  Â  Â  Â  Â  Â  Â  Â  jumlah: jumlah,
Â  Â  Â  Â  Â  Â  Â  Â  guru: ''Â 
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  simpanLog(newLogData);
Â  Â  Â  Â  Â  Â  alert(`Pengumpulan HP Awal untuk kelas ${kelas} (${jumlah} unit) berhasil dicatat.`);
Â  Â  Â  Â  Â  Â  document.getElementById('pagi_kelas').value = '';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('pagi_jumlah').value = '';
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNGSI PINJAM (VALIDASI SISA HP) ---
Â  Â  Â  Â  function catatPeminjaman() {
Â  Â  Â  Â  Â  Â  const pj = document.getElementById('pinjam_pj').value;
Â  Â  Â  Â  Â  Â  const kelas = document.getElementById('pinjam_kelas').value;
Â  Â  Â  Â  Â  Â  const jumlah = document.getElementById('pinjam_jumlah').value;
Â  Â  Â  Â  Â  Â  const guru = document.getElementById('pinjam_guru').value;

Â  Â  Â  Â  Â  Â  if (!pj || !kelas || !jumlah || !guru) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Semua kolom Peminjaman harus diisi!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const logData = muatLog();
Â  Â  Â  Â  Â  Â  let statusKelas = { [kelas]: { awal: 0, keluar: 0 } };Â 
Â  Â  Â  Â  Â  Â  logData.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  if (item.kelas === kelas) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const jml = parseInt(item.jumlah);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (item.aksi === 'PENGUMPULAN PAGI') { statusKelas[kelas].awal = jml; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (item.aksi === 'PINJAM (KELUAR)') { statusKelas[kelas].keluar += jml; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (item.aksi === 'KEMBALI (MASUK)') { statusKelas[kelas].keluar -= jml; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const sisaHP = (statusKelas[kelas].awal || 0) - (statusKelas[kelas].keluar || 0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (sisaHP < parseInt(jumlah)) {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`HP kelas ${kelas} yang tersisa di piket hanya ${sisaHP}. Tidak cukup untuk meminjam ${jumlah} unit. Transaksi dibatalkan!`);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  logData.unshift({Â 
Â  Â  Â  Â  Â  Â  Â  Â  aksi: 'PINJAM (KELUAR)',
Â  Â  Â  Â  Â  Â  Â  Â  waktu: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  pj: pj,
Â  Â  Â  Â  Â  Â  Â  Â  kelas: kelas,
Â  Â  Â  Â  Â  Â  Â  Â  jumlah: jumlah,
Â  Â  Â  Â  Â  Â  Â  Â  guru: guru
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  simpanLog(logData);
Â  Â  Â  Â  Â  Â  alert(`Peminjaman HP oleh ${pj} (${jumlah} unit) berhasil dicatat.`);
Â  Â  Â  Â  Â  Â  document.getElementById('pinjam_pj').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('pinjam_jumlah').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('pinjam_guru').value = '';
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNGSI PENGEMBALIAN ---
Â  Â  Â  Â  function catatPengembalian() {
Â  Â  Â  Â  Â  Â  const pj = document.getElementById('kembali_pj').value;
Â  Â  Â  Â  Â  Â  const kelas = document.getElementById('kembali_kelas').value;
Â  Â  Â  Â  Â  Â  const jumlah = document.getElementById('kembali_jumlah').value;

Â  Â  Â  Â  Â  Â  if (!pj || !kelas || !jumlah) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Semua kolom Pengembalian harus diisi!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const logData = muatLog();
Â  Â  Â  Â  Â  Â  logData.unshift({
Â  Â  Â  Â  Â  Â  Â  Â  aksi: 'KEMBALI (MASUK)',
Â  Â  Â  Â  Â  Â  Â  Â  waktu: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  pj: pj,
Â  Â  Â  Â  Â  Â  Â  Â  kelas: kelas,
Â  Â  Â  Â  Â  Â  Â  Â  jumlah: jumlah,
Â  Â  Â  Â  Â  Â  Â  Â  guru: ''Â 
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  simpanLog(logData);
Â  Â  Â  Â  Â  Â  alert(`Pengembalian HP oleh ${pj} (${jumlah} unit) berhasil dicatat.`);
Â  Â  Â  Â  Â  Â  document.getElementById('kembali_pj').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('kembali_jumlah').value = '';
Â  Â  Â  Â  }

Â  Â  Â  Â  // Jalankan fungsi saat halaman dimuat
Â  Â  Â  Â  window.onload = function() {
Â  Â  Â  Â  Â  Â  // Kita tidak memuat tabel di awal agar fokus pada input
Â  Â  Â  Â  };
Â  Â  </script>

</body>
</html>
